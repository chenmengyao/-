(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a38c4984"],{"3e93":function(e,s,t){"use strict";var o=t("780d"),a=t.n(o);a.a},"780d":function(e,s,t){},dfa3:function(e,s,t){"use strict";t.r(s);var o=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"suwis-confirm-order"},[t("van-cell-group",{staticClass:"address"},[t("div"),t("van-cell",[t("div",{attrs:{slot:"title"},slot:"title"},[e._v("收货人："+e._s(e.address&&e.address.name||"")+" "+e._s(e.address&&e.address.tel?"（"+e.address.tel+"）":""))])]),t("van-cell",{attrs:{"title-class":"cell-flex",clickable:""},on:{click:e.selectAddress}},[t("template",{slot:"title"},[e._v("\r\n        收货地址："+e._s(e._f("location")(e.address))+"\r\n        "),t("van-icon",{staticStyle:{"margin-left":"28px"},attrs:{name:"arrow",size:"10px",color:"#b4b4b4"}})],1)],2)],1),e.shopList&&e.shopList.length?e._l(e.shopList,(function(s){return t("div",{key:s.id,staticClass:"goods-box"},[t("div",{staticClass:"shop-info",on:{click:function(t){return e.onClickStore(s[0])}}},[t("img",{staticClass:"shop-logo",attrs:{src:s[0].logo||e.defaultShopLogo,alt:"店铺头像",width:"20",height:"20"}}),t("span",{staticClass:"shop-name"},[e._v(e._s(s[0].name))])]),e._l(s,(function(s){return t("van-card",{key:s.goods_id,attrs:{num:"single"===e.orderFrom?e.num:s.num,price:"0"==s.type||"3"==s.type?s.price:"1"==s.type?s.push_price:"4"==s.type?s.clearance_price:"",title:s.title,thumb:s.img},on:{click:function(t){return e.onClick(s)}},scopedSlots:e._u([{key:"desc",fn:function(){return[t("div",{staticClass:"desc-line"},[s.header_one?t("div",{staticClass:"desc-item"},[e._v(e._s(s.header_one))]):e._e(),s.header_two?t("div",{staticClass:"desc-item"},[e._v(e._s(s.header_two))]):e._e(),s.header_three?t("div",{staticClass:"desc-item"},[e._v(e._s(s.header_three))]):e._e()])]},proxy:!0}],null,!0)})}))],2)})):e._e(),t("van-cell-group",{staticClass:"personal-box"},["single"===e.orderFrom?t("van-cell",{attrs:{title:"购买数量",center:"","value-class":"cell-content"}},[[t("van-stepper",{on:{change:e.singleNumChange},model:{value:e.num,callback:function(s){e.num=s},expression:"num"}})]],2):e._e(),t("van-cell",{attrs:{title:"配送方式",center:"","value-class":"content"}},[[e._v("\r\n        普通快递 "),t("span",{staticStyle:{"font-size":"10px"}},[e._v("（运费：￥"+e._s(e.postage)+"）")])]],2),t("van-field",{attrs:{maxlength:"100",clearable:"",label:"买家留言",placeholder:"请填写备注信息"},model:{value:e.express_remark,callback:function(s){e.express_remark="string"===typeof s?s.trim():s},expression:"express_remark"}})],1),t("van-cell-group",{staticClass:"discount-box"},[t("van-cell",{attrs:{center:"","value-class":"cell-content"}},[t("template",{slot:"title"},[e.couponList.length?t("van-checkbox",{on:{change:e.getData},model:{value:e.useCoupon,callback:function(s){e.useCoupon=s},expression:"useCoupon"}},[e._v("\r\n          卖家优惠券\r\n        ")]):t("div",[e._v("暂无可用优惠券")])],1),e.couponList.length?[t("div",{on:{click:e.selectCoupon}},[t("span",[e._v(e._s(e.coupon.coupon_id?e.coupon.title:"去使用"))]),t("van-icon",{attrs:{name:"arrow",size:"10px",color:"#b4b4b4"}})],1)]:e._e()],2),1===e.user_type||2===e.user_type?t("van-cell",{attrs:{center:"","value-class":"cell-content short-content"}},[t("template",{slot:"title"},[t("van-checkbox",{on:{change:function(s){e.useDiscount=!0}},model:{value:e.useDiscount,callback:function(s){e.useDiscount=s},expression:"useDiscount"}},[e._v("会员优惠 "),1===e.shopList.length?t("span",{staticStyle:{color:"#b4b4b4","font-size":"12px","line-height":"24px"}},[e._v("（会员折扣"+e._s(e.shopList[0][0].vipdiscount)+"折）")]):e._e()])],1),[e._v("\r\n        -"+e._s(e.discount)+"\r\n      ")]],2):e._e(),t("van-cell",{attrs:{center:"","value-class":"cell-content short-content"}},[t("template",{slot:"title"},[t("van-checkbox",{on:{change:e.getData},model:{value:e.useScore,callback:function(s){e.useScore=s},expression:"useScore"}},[e._v("\r\n          积分抵扣 "),t("span",{staticStyle:{color:"#b4b4b4","font-size":"12px","line-height":"24px"}},[e._v("（可用积分："+e._s(e.score_need)+"）")]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.score,expression:"score"}]},[e._v("使用"+e._s(e.score)+"分")])])],1),[t("div",{on:{click:e.setScore}},[e._v("\r\n          去使用\r\n          "),t("van-icon",{attrs:{name:"arrow",size:"10px",color:"#b4b4b4"}})],1)]],2)],1),t("van-cell-group",{staticClass:"result-box"},[t("van-cell",{attrs:{title:"还需支付",center:"","value-class":"cell-content"}},[[t("span",{staticStyle:{color:"#e83f44"}},[e._v("￥"+e._s(e.total))])]],2)],1),t("div",{staticClass:"submit-box"},[t("span",[e._v("合计："),t("span",{staticStyle:{color:"#e83f44"}},[e._v(e._s(e.total))])]),t("button",{staticClass:"submit",on:{click:e.toPay}},[e._v("提交订单")])]),t("PayType",{attrs:{show:e.payTypeShow,"balance-sum":e.balance_sum,"order-id":e.orderId},on:{close:e.paySuccess,fail:e.payFail,pay:e.confirmPay}}),t("CouponList",{attrs:{title:"选择优惠券"},model:{value:e.couponShow,callback:function(s){e.couponShow=s},expression:"couponShow"}},e._l(e.couponList,(function(s){return t("couponItem",{key:s.id,attrs:{title:s.title,desc:"满"+s.total+"元即可使用",price:s.sum,time:s.end_time,type:"1","btn-text":"使用"},on:{click:function(t){return e.onCouponClick(s)}}})})),1),t("van-actionsheet",{attrs:{title:"请输入支付密码","close-on-click-overlay":!1},on:{cancel:e.closePasswordModal},model:{value:e.passwordModalShow,callback:function(s){e.passwordModalShow=s},expression:"passwordModalShow"}},[t("van-password-input",{attrs:{value:e.password}}),t("div",{staticClass:"link-line"},[t("router-link",{staticClass:"forget-password",attrs:{to:"/resetpaypwd"}},[e._v("忘记支付密码？")])],1),t("van-number-keyboard",{attrs:{show:!0},on:{input:e.onPasswordInput,delete:e.onPasswordDelete}})],1)],2)},a=[],r=(t("96cf"),t("3b8d")),i=(t("a481"),t("8615"),t("7514"),t("c5f6"),t("ac4d"),t("8a81"),t("ac6a"),t("724c")),n=t.n(i),c=t("2916"),d=t("cb92"),u=t("b8f2"),l=t("a04d"),p=t("6821f"),h=t.n(p),_=t("b970"),v={components:{CouponList:d["a"],CouponItem:u["a"],PayType:c["a"]},filters:{location:function(e){if(e){var s=e.province||"",t=e.city||"",o=e.area||"",a=e.address||"";return s+t+o+a||"---"}return"---"}},computed:{postage:function(){return this.shopList.reduce((function(e,s){var t=!0,o=!1,a=void 0;try{for(var r,i=s[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var n=r.value;e+=Number(n.postage)}}catch(c){o=!0,a=c}finally{try{t||null==i.return||i.return()}finally{if(o)throw a}}return e}),0)}},data:function(){return{address_id:"",address:{name:"",tel:""},balance_sum:0,car_id:"",couponList:[],coupon:{},currentPayType:null,couponShow:!1,discount:0,useDiscount:!0,defaultShopLogo:n.a,express_remark:"",num:0,password:"",passwordModalShow:!1,score_balance:0,score_need:0,score:0,stand_id:"",shopList:[],total:0,useCoupon:!0,useScore:!0,orderFrom:"",payTypeShow:!1,currentOrderSumPice:0,orderId:"",user_type:0}},methods:{singleNumChange:function(){this.getData()},closePasswordModal:function(){this.password=""},getBalance:function(){var e=this;this.$axios.post("/mine/mycommission").then((function(s){var t=s.data;1===t.code?t.data&&(e.balance_sum=t.data):e.$toast(t.msg)}))},getData:function(){var e,s,t=this;"single"===this.orderFrom?(e="/goods/makesureorder",s={stand_id:this.stand_id,num:this.num,coupon_sum:this.useCoupon?this.coupon.sum:void 0,is_vip:this.useDiscount?1:void 0,score_sum:this.useScore?this.score:void 0}):"car"===this.orderFrom&&(e="/car/makesureorder",s={car_id:this.car_id,coupon_sum:this.useCoupon?this.coupon.sum:void 0,is_vip:this.useDiscount?1:void 0,score_sum:this.useScore?this.score:void 0}),this.$axios.post(e,s).then((function(e){var s=e.data;if(1===s.code){if(s.data){if(t.handleData("single"===t.orderFrom?[s.data.goods]:s.data.car),t.total=s.data.total,t.discount=s.data.use_vipdiscount,t.couponList=s.data.coupon,t.coupon&&t.coupon.id){var o=!1;t.couponList.forEach((function(e){e.id===t.coupon.id&&(o=!0)})),o||(t.coupon={})}t.score_need=s.data.score_need||0,t.user_type=s.data.user_type,t.address_id?t.address=s.data.address.find((function(e){return t.address_id?e.id===+t.address_id:1===e.sta})):t.address=s.data.address[0],t.address_id||(t.address_id=t.address.id)}}else"single"===t.orderFrom&&t.num--,t.$toast(s.msg)}))},handleData:function(e){var s=e.reduce((function(e,s){return e[s.id]?e[s.id].push(s):e[s.id]=[s],e}),{});this.shopList=Object.values(s)},onClick:function(e){this.$router.push({path:"/goods/details",query:{id:e.goods_id}})},onClickStore:function(e){this.$router.push({path:"/shop",query:{id:e.store_id}})},onCouponClick:function(e){this.coupon=e,this.getData(),this.couponShow=!1},onPasswordInput:function(e){var s=this;this.password.length<6&&(this.password=this.password+e),6===this.password.length&&this.$axios.post("/pay/pay",{order:this.orderId,pay_type:this.currentPayType.key,paypass:"balancepay"===this.currentPayType.key?h()(this.password):void 0}).then((function(e){var t=e.data;if(1===t.code){s.$toast("支付成功"),s.passwordModalShow=!1;var o=s;setTimeout((function(){o.$router.replace({path:"/uc/orders",query:{activeTabIndex:2,type:"0000"}})}),699)}else s.password="",s.$toast(t.msg)}))},onPasswordDelete:function(){this.password=this.password.slice(0,this.password.length-1)},selectAddress:function(){this.$router.push({path:"/uc/setting/address",query:{from:this.$route.path,car_id:"single"===this.orderFrom?void 0:this.car_id,express_remark:this.express_remark,stand_id:"single"===this.orderFrom?this.stand_id:void 0,num:"single"===this.orderFrom?this.num:void 0,score:this.score}})},selectCoupon:function(){this.couponList.length?this.couponShow=!0:this.$toast("抱歉，暂无可用优惠券")},confirmPay:function(e){this.currentPayType=l["a"].find((function(s){return s.key===e})),"balancepay"==this.currentPayType.key&&this.total>this.balance_sum?this.$toast("可用佣金不足！"):this.passwordModalShow=!0},paySuccess:function(){this.payTypeShow=!1,this.$router.replace({path:"/uc/orders",query:{activeTabIndex:2,type:"0000"}})},payFail:function(){this.payTypeShow=!1,this.$router.replace({path:"/uc/orders",query:{activeTabIndex:1,type:"0000"}})},setScore:function(){this.$router.push({path:"/uc/orders/score-discount",query:{address_id:this.address_id,car_id:"single"===this.orderFrom?void 0:this.car_id,express_remark:this.express_remark,score_need:this.score_need,stand_id:"single"===this.orderFrom?this.stand_id:void 0,num:"single"===this.orderFrom?this.num:void 0}})},toPay:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var s,t,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.address_id){e.next=3;break}return Object(_["i"])("请填写地址！"),e.abrupt("return");case 3:return this.payTypeShow=!0,"single"===this.orderFrom?(s="/goods/topay",t={stand_id:this.stand_id,num:this.num,coupon_id:this.useCoupon?this.coupon.id:void 0,is_vip:this.useDiscount?1:void 0,is_score:this.useScore?this.score:void 0,address_id:this.address_id,express_remark:this.express_remark||""}):"car"===this.orderFrom&&(s="/car/topay",t={car_id:this.car_id,coupon_id:this.useCoupon?this.coupon.id:void 0,is_vip:this.useDiscount?1:void 0,is_score:this.useScore?this.score:void 0,address_id:this.address_id,express_remark:this.express_remark||""}),e.next=8,this.$axios.post(s,t);case 8:o=e.sent,this.orderId=o.data.data;case 10:case"end":return e.stop()}}),e,this)})));function s(){return e.apply(this,arguments)}return s}()},watch:{$route:function(e,s){this.$route.path===e.path&&this.$router.go(-1)}},created:function(){var e=this;this.$route.query.stand_id?(this.orderFrom="single",this.stand_id=this.$route.query.stand_id,this.num=this.$route.query.num):this.$route.query.car_id&&(this.orderFrom="car",this.car_id=this.$route.query.car_id),this.$axios.post("/mine/myscore").then((function(s){var t=s.data;1===t.code?t.data&&(e.score_balance=t.data.score_balance):e.$toast(t.msg)})).catch((function(){e.error=!0})),this.getBalance(),this.score=this.$route.query.score,this.address_id=this.$route.query.address_id||"",this.express_remark=this.$route.query.express_remark,this.getData()}},m=v,y=(t("3e93"),t("2877")),f=Object(y["a"])(m,o,a,!1,null,"39fb9064",null);s["default"]=f.exports}}]);